<!DOCTYPE html>
<html lang="fr">

<link rel="stylesheet" href="/3rdparty/font-awesome5/css/all.min.css">
<link rel="stylesheet" href="/core/css/icon/icons.css">

<head>
    <meta charset="UTF-8">
    <title>Neumorphism Menu</title>
</head>

<body>
    <nav id="menu">
        <!-- Génération dynamique du menu depuis le json de configuration -->
    </nav>
    
    <div id="content" class="content" style="padding: 0px">
        <div id="i_frame">
            <!-- Div pour inclure les écrans de design dans une iframe -->
        </div>
    </div>
    
    <script language="javascript">
        // Valeurs par défaut
        //
        var fullscreen = 'fullscreen=1';
        var labelFirst = true;
        var menuHorizontal = true;
        // forcer rechargement du fichier css
        let forceRefreshCss = true;
        // url du fichier de configuration
       // var ThemePath = "Themes/ControlCenter";   // Repertoire du theme
        var jsonPath = "json/perso.json";           // Emplacement et nom du fichier json du theme en cours
        var cssPath = "css/menu";                   // Emplacement des fichier css (ne pas mettre l'extension. traité selon orientation du menu)
        // Valeurs par défaut (valeurs utilisées si non précisées dans le json de configuration)
        // paramétrage des frames
        var defaultMenuHeight = "70px";             // (facultatif) hauteur du menu
        var defaultFrameTop = "0px";                // (facultatif) position top de la frame contenant les plans
        var defaultFrameLeft = "0px";
        var defaultFrameWidth = "1280px";           // (facultatif) largeur de la frame contenant les plans
        var defaultFrameHeight = "1000px";          // (facultatif) hauteur de la frame contenant les plans
        // nom de l'image de fond du menu sans focus
        var inactiveBackgroundCssImage = "Metal";
        // nom de l'image de fond du menu avec focus
        var activeBackgroundCssImage = "Metal";
        // paramétrage des couleurs
        var borderMenu = "#151515";
        var backgroundActiveLink = "#202020";
        var backgroundDefaultLink = "#151515";
        // parametrage du curseur
        var defaultCursorColor = "#33b8cc";         // (facultatif) couleur du curseur sélectionné
        var defaultCursorDefaultColor = "dimgray";  // (facultatif) couleur des éléments non sélectionnés du menu
        var CursorColorShadow = "blue";             // (facultatif) couleur des ombres du menu
        var defaultCursorWidth = "1.5rem";          // (facultatif) largeur des boutons du menu
        var defaultCursorHeight = "0.5rem";         // (facultatif) hauteur des boutons du menu
     //   var iframe =  "yes";                        // (facultatif) gestion de la navigation par frame

        // constantes
        // url de page d'accueil (premier lien du menu récupéré dynamiquement)
        var homeLink = "";
        // temps d'attente avant chargement du design du premier bouton
        var waitForLoadingFrame = 1; // ms
        var menuName = "menuNeumorphism";

        // Initialisation des données avant la création du menu
        function initData() {
            // initialisation CSS
            var cssUrl = cssPath + (menuHorizontal ? "" : "-v") + (labelFirst ? "" : "2") + ".css";
            var cssLink = document.createElement('link');
            cssLink.setAttribute('rel', 'stylesheet');
            cssLink.setAttribute('type', 'text/css');
            let hrefAttribute = cssUrl + ((forceRefreshCss == true) ? ('?v=' + Date.now()) : '');
            cssLink.setAttribute("href", hrefAttribute);
            document.getElementsByTagName('head')[0].appendChild(cssLink);
    
            // récupération de la couleur du curseur
            var cursorColor = defaultCursorColor;
            var cursorDefaultColor = defaultCursorDefaultColor
            var cursorWidth = defaultCursorWidth
            var cursorHeight = defaultCursorHeight
            var menuHeight = defaultMenuHeight
    
            if (typeof (json_theme["parameters"]["cursorColor"]) !== "undefined") {
                cursorColor = json_theme["parameters"]["cursorColor"];
            }
            if (typeof (json_theme["parameters"]["cursorDefaultColor"]) !== "undefined") {
                cursorDefaultColor = json_theme["parameters"]["cursorDefaultColor"];
            }
            if (typeof (json_theme["parameters"]["cursorWidth"]) !== "undefined") {
                cursorWidth = json_theme["parameters"]["cursorWidth"];
            }
            if (typeof (json_theme["parameters"]["cursorHeight"]) !== "undefined") {
                cursorHeight = json_theme["parameters"]["cursorHeight"];
            }
            if (typeof (json_theme["parameters"]["menuHeight"]) !== "undefined") {
                menuHeight = json_theme["parameters"]["menuHeight"];
            }

            // modification des couleurs du menu
            document.documentElement.style.setProperty('--cursor-color', cursorColor);
            document.documentElement.style.setProperty('--cursor-default-color', cursorDefaultColor);
            document.documentElement.style.setProperty('--cursor-width', cursorWidth);
            document.documentElement.style.setProperty('--cursor-height', cursorHeight);
            document.documentElement.style.setProperty('--menu-height', menuHeight);
        }

        function initAfterCreation() {
            // gestion de la sélection du menu
            const lis = document.querySelectorAll("#menu li");
    
            for (let i = 0; i < lis.length; i++) {
                lis[i].addEventListener("click", function () {
                    for (let i = 0; i < lis.length; i++) {
                        lis[i].classList.remove("active");
                    }
                    this.classList.add("active");
                });
            }

            // gestion par frame : affichage du premier lien au chargement
            if (waitForLoadingFrame != 0) {
                setTimeout(loadFrame, waitForLoadingFrame);
            }
        }

        // chargement de la page de design du bouton de menu sélectionné
        function loadFrame() {
            if ((typeof json_theme["parameters"]["iframe"] !== undefined) && (json_theme["parameters"]["iframe"] === "yes")) {
                gotoPlan(homeLink);
            }
        }

        // Calcul de l'url de destination
        function getUrlDestination(urlParam) {
            if (isNaN(urlParam)) {
                return urlParam;
            } else {
                return '/index.php?v=d&p=plan&plan_id=' + urlParam + '&fullscreen=1';
            }
        }
    
        // affichage du plan idPlan
        function gotoPlan(idPlan) {
            let frame_destination = document.getElementById('iframe_a');
            let urlDestination = getUrlDestination(idPlan);
    
            if (isNaN(idPlan)) {
                // url externe
                window.open(urlDestination, '_blank');
            } else {
                if (frame_destination === null) {
                    // pas de frame
                    if (window.location.href.split('?')[1] != urlDestination.split('?')[1]) {
                        window.location.href = urlDestination;
                    }
                } else {
                    // gestion de la navigation par frame
                    if (frame_destination.src.split('?')[1] != urlDestination.split('?')[1]) {
                        frame_destination.src = urlDestination;
                    }
                }
            }
        }

        //verification de la presence du fichier json et parse du contenu
        // vérification de la présence d'un fichier (ici pour le fichier json de paramétrage)
        function checkFile() {
            // load Json configuration file
            var xhr = new XMLHttpRequest();
            xhr.open('GET', jsonPath, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        // récupération du fichier de configuration OK
                        let resp = xhr.responseText;
                        let respJson = JSON.parse(resp);
                        jsonCallback(respJson);
                    } else {
                        jsonCallback(null);
                    }
                }
            }
            xhr.send();
        }

        function jsonCallback(response) {
            if (response != null) {
                // chargement du menu
                json_theme = response;
                initData();
                createTheme();
                initAfterCreation();
            } else {
                // fichier de configuration non trouvé
                let menu = document.getElementById("MenuFrame");
                menu.innerHTML = "Attention, problème de chargement du fichier de configuration menu.json. Vérifiez son existence et emplacement";
            }
        }
    
        function createTheme() {
            // récupération du temps d'attente pour le chargement de la frame au chargement de la page (en ms)
            if ((typeof json_theme["parameters"]["timeout"] !== undefined) && !isNaN(json_theme["parameters"]["timeout"])) {
                waitForLoadingFrame = json_theme["parameters"]["timeout"];
            }
    
            // création de la frame
            let menu_id = document.getElementById('i_frame');
            if ((typeof json_theme["parameters"]["iframe"] !== undefined) && (json_theme["parameters"]["iframe"] === "yes")) {
                // position de l'iframe
                let frameTop = defaultFrameTop;
    
                if (typeof (json_theme["parameters"]["frameTop"]) !== "undefined") {
                    frameTop = json_theme["parameters"]["frameTop"]
                }
    
                let menu_content = document.getElementById('content');
                menu_content.style = "padding: 0px; position: absolute; top: " + frameTop;
    
                // iframe pour afficher la page courante
                let menu_f = document.createElement("div");
                menu_f.className = "menuf";
    
                let menu_iframe = document.createElement("iframe");
                menu_iframe.id = "iframe_a";
                var cssUrl = cssPath + (menuHorizontal ? "" : "-v") + (labelFirst ? "" : "2") + ".css";
                var cssLink = document.createElement('link');
                cssLink.setAttribute('rel', 'stylesheet');
                cssLink.setAttribute('type', 'text/css');
                let hrefAttribute = cssUrl + ((forceRefreshCss == true) ? ('?v=' + Date.now()) : '');
                cssLink.setAttribute("href", hrefAttribute);
                menu_iframe.appendChild(cssLink);
    
                let frameWidth = defaultFrameWidth;
                if (typeof (json_theme["parameters"]["frameWidth"]) !== "undefined") {
                    frameWidth = json_theme["parameters"]["frameWidth"];
                }
                menu_iframe.width = frameWidth;
    
                let frameHeight = defaultFrameHeight;
                if (typeof (json_theme["parameters"]["frameHeight"]) !== "undefined") {
                    frameHeight = json_theme["parameters"]["frameHeight"];
                }
                menu_iframe.height = frameHeight;
    
                menu_iframe.frameBorder = "0";
                menu_iframe.scrolling = "no";
                menu_iframe.src = "";
    
                menu_f.appendChild(menu_iframe);
                menu_id.appendChild(menu_f);
            }
    
            // construction du menu
            let menu = document.getElementById("menu");
    
            let menu_ul = document.createElement("ul");
            menu_ul.className = "navul";
/*          let menu_ul_i = document.createElement("i");
            menu_ul_i.setAttribute("class", "icon jeedomapp-in");
            menu_ul.appendChild(menu_ul_i); */

            for (let i = 0; i < json_theme["buttons"].length; i++) {
                let menu_item = document.createElement("li");
                let link = json_theme["buttons"][i].link;
                if (homeLink === "") {
                    homeLink = link;
                    // focus sur premier element du menu
                    menu_item.className = "active";
                }
    
                // Infobulle
                menu_item.setAttribute("data-placement", "bottom");
                menu_item.setAttribute("title", json_theme["buttons"][i].label);
                menu_item.setAttribute("onclick", "gotoPlan(" + link + ")");
    
                let menu_item_i = document.createElement("i");
                menu_item_i.setAttribute("class", json_theme["buttons"][i].icon);
    
                menu_item.appendChild(menu_item_i);
                menu_ul.appendChild(menu_item);
            }
            menu.appendChild(menu_ul);
        }
        // création dynamique du menu
        checkFile();
        //createTheme();
    </script>
</body>
</html>